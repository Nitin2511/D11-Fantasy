<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T20 World Cup 2026 Fantasy League</title>
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase v9 (Modular SDK) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, query, where, getDocs, doc, setDoc, getDoc, addDoc, updateDoc, deleteDoc, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDacks7Qnk42D2898leU_kgG8DZsYTFxCw",
            authDomain: "t20-fantasy-contest.firebaseapp.com",
            projectId: "t20-fantasy-contest",
            storageBucket: "t20-fantasy-contest.firebasestorage.app",
            messagingSenderId: "180217303236",
            appId: "1:180217303236:web:a6b078a7a7d0fa070c3991",
            measurementId: "G-LYY944KN99"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make globally available
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseModules = {
            collection, query, where, getDocs, doc, setDoc, getDoc, addDoc, 
            updateDoc, deleteDoc, orderBy, onSnapshot,
            signInWithEmailAndPassword, createUserWithEmailAndPassword,
            signOut, onAuthStateChanged
        };
        window.firebaseReady = true;
        
        console.log("‚úÖ Firebase initialized successfully!");
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: #0a0e1a;
            color: #e0e6ed;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0a0e1a 0%, #0f1729 100%);
            pointer-events: none;
            z-index: 0;
        }
        
        #root {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            padding: 40px 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            letter-spacing: 3px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            position: relative;
            z-index: 1;
        }

        .user-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: rgba(31, 41, 55, 0.5);
            padding: 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 150px;
            padding: 18px;
            background: transparent;
            border: 2px solid transparent;
            color: #9ca3af;
            font-weight: 600;
            cursor: pointer;
            border-radius: 15px;
            transition: all 0.3s;
            font-size: 16px;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tab:hover {
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #10b981;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        /* Card Styles */
        .card {
            background: rgba(31, 41, 55, 0.6);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .card h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            margin-bottom: 25px;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Button Styles */
        .btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
        }

        /* Contest List */
        .contest-list {
            display: grid;
            gap: 20px;
        }

        .contest-item {
            background: rgba(15, 23, 42, 0.6);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.2);
            transition: all 0.3s;
        }

        .contest-item:hover {
            border-color: #10b981;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
        }

        .contest-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .contest-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #10b981;
            font-weight: 700;
        }

        .contest-status {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .status-upcoming {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .status-completed {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .contest-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #cbd5e1;
        }

        .info-icon {
            font-size: 1.2rem;
        }

        .contest-actions {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Match List */
        .match-list {
            display: grid;
            gap: 20px;
        }

        .match-item {
            background: rgba(15, 23, 42, 0.6);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(59, 130, 246, 0.2);
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .team {
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
        }

        .vs {
            color: #10b981;
            font-weight: 800;
            font-size: 1.1rem;
        }

        .match-details {
            display: flex;
            gap: 25px;
            color: #94a3b8;
            font-size: 0.95rem;
            flex-wrap: wrap;
        }

        /* Player Selection */
        .player-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: rgba(31, 41, 55, 0.6);
            border: 2px solid rgba(148, 163, 184, 0.2);
            color: #cbd5e1;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .player-card {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(148, 163, 184, 0.2);
            transition: all 0.3s;
            cursor: pointer;
        }

        .player-card:hover {
            border-color: #10b981;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }

        .player-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .player-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .player-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #fff;
        }

        .player-credits {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .player-info {
            display: flex;
            gap: 15px;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .player-role {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Team Summary */
        .team-summary {
            position: sticky;
            top: 20px;
            background: rgba(15, 23, 42, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #10b981;
            backdrop-filter: blur(10px);
        }

        .summary-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: #10b981;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .summary-stats {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(31, 41, 55, 0.5);
            border-radius: 10px;
        }

        .stat-label {
            color: #94a3b8;
        }

        .stat-value {
            font-weight: 700;
            color: #fff;
        }

        .stat-value.warning {
            color: #f59e0b;
        }

        .stat-value.danger {
            color: #ef4444;
        }

        .selected-players-list {
            margin-top: 20px;
        }

        .selected-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(31, 41, 55, 0.5);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .captain-controls {
            display: flex;
            gap: 8px;
        }

        .captain-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .captain-btn.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .captain-btn:not(.active) {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }

        /* Leaderboard */
        .leaderboard-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .leaderboard-table thead th {
            background: rgba(16, 185, 129, 0.2);
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: #10b981;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .leaderboard-table thead th:first-child {
            border-radius: 10px 0 0 10px;
        }

        .leaderboard-table thead th:last-child {
            border-radius: 0 10px 10px 0;
        }

        .leaderboard-table tbody tr {
            background: rgba(15, 23, 42, 0.6);
            transition: all 0.3s;
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(16, 185, 129, 0.1);
            transform: scale(1.01);
        }

        .leaderboard-table tbody td {
            padding: 15px;
        }

        .leaderboard-table tbody tr td:first-child {
            border-radius: 10px 0 0 10px;
        }

        .leaderboard-table tbody tr td:last-child {
            border-radius: 0 10px 10px 0;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
        }

        .rank-1 {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
        }

        .rank-2 {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
        }

        .rank-3 {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
        }

        .rank-other {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }

        /* Login Page */
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            background: rgba(31, 41, 55, 0.8);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .login-container h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            margin-bottom: 30px;
            color: #10b981;
            text-align: center;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #93c5fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #6ee7b7;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 40px;
            color: #10b981;
            font-size: 1.2rem;
        }

        .spinner {
            border: 4px solid rgba(16, 185, 129, 0.1);
            border-left-color: #10b981;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .user-badge, .logout-btn {
                position: static;
                margin: 10px auto;
                display: inline-block;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .players-grid {
                grid-template-columns: 1fr;
            }

            .team-summary {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Real T20 World Cup 2026 Data
        const WORLD_CUP_TEAMS = {
            'IND': 'India',
            'PAK': 'Pakistan',
            'AUS': 'Australia',
            'ENG': 'England',
            'NZ': 'New Zealand',
            'SA': 'South Africa',
            'SL': 'Sri Lanka',
            'WI': 'West Indies',
            'AFG': 'Afghanistan',
            'BAN': 'Bangladesh',
            'IRE': 'Ireland',
            'SCOT': 'Scotland',
            'NED': 'Netherlands',
            'NEP': 'Nepal',
            'NAM': 'Namibia',
            'OMA': 'Oman',
            'ZIM': 'Zimbabwe',
            'CAN': 'Canada',
            'USA': 'United States',
            'UAE': 'United Arab Emirates',
            'ITA': 'Italy'
        };

        const SAMPLE_PLAYERS = {
            'IND': [
                { name: 'Suryakumar Yadav', role: 'Batsman', credits: 10.0, team: 'IND' },
                { name: 'Hardik Pandya', role: 'All-Rounder', credits: 9.5, team: 'IND' },
                { name: 'Jasprit Bumrah', role: 'Bowler', credits: 10.0, team: 'IND' },
                { name: 'Ishan Kishan', role: 'Wicket-Keeper', credits: 8.5, team: 'IND' },
                { name: 'Axar Patel', role: 'All-Rounder', credits: 8.0, team: 'IND' },
                { name: 'Arshdeep Singh', role: 'Bowler', credits: 8.5, team: 'IND' },
                { name: 'Tilak Varma', role: 'Batsman', credits: 8.0, team: 'IND' },
                { name: 'Kuldeep Yadav', role: 'Bowler', credits: 8.5, team: 'IND' },
                { name: 'Rinku Singh', role: 'Batsman', credits: 8.0, team: 'IND' },
                { name: 'Abhishek Sharma', role: 'Batsman', credits: 7.5, team: 'IND' }
            ],
            'PAK': [
                { name: 'Babar Azam', role: 'Batsman', credits: 10.0, team: 'PAK' },
                { name: 'Shaheen Shah Afridi', role: 'Bowler', credits: 9.5, team: 'PAK' },
                { name: 'Shadab Khan', role: 'All-Rounder', credits: 8.5, team: 'PAK' },
                { name: 'Naseem Shah', role: 'Bowler', credits: 8.5, team: 'PAK' },
                { name: 'Fakhar Zaman', role: 'Batsman', credits: 8.5, team: 'PAK' },
                { name: 'Usman Khan', role: 'Wicket-Keeper', credits: 8.0, team: 'PAK' },
                { name: 'Saim Ayub', role: 'Batsman', credits: 7.5, team: 'PAK' },
                { name: 'Salman Agha', role: 'All-Rounder', credits: 8.0, team: 'PAK' }
            ],
            'ENG': [
                { name: 'Harry Brook', role: 'Batsman', credits: 9.5, team: 'ENG' },
                { name: 'Jos Buttler', role: 'Wicket-Keeper', credits: 9.5, team: 'ENG' },
                { name: 'Jofra Archer', role: 'Bowler', credits: 9.0, team: 'ENG' },
                { name: 'Sam Curran', role: 'All-Rounder', credits: 9.0, team: 'ENG' },
                { name: 'Adil Rashid', role: 'Bowler', credits: 8.5, team: 'ENG' },
                { name: 'Phil Salt', role: 'Batsman', credits: 8.5, team: 'ENG' }
            ],
            'AUS': [
                { name: 'Mitchell Marsh', role: 'All-Rounder', credits: 9.5, team: 'AUS' },
                { name: 'Travis Head', role: 'Batsman', credits: 9.0, team: 'AUS' },
                { name: 'Glenn Maxwell', role: 'All-Rounder', credits: 9.0, team: 'AUS' },
                { name: 'Josh Inglis', role: 'Wicket-Keeper', credits: 8.5, team: 'AUS' },
                { name: 'Adam Zampa', role: 'Bowler', credits: 8.5, team: 'AUS' }
            ]
        };

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (!window.firebaseAuth) return;

                const unsubscribe = window.firebaseModules.onAuthStateChanged(
                    window.firebaseAuth,
                    async (authUser) => {
                        if (authUser) {
                            try {
                                // Fetch user data from Firestore using auth UID
                                const { doc, getDoc } = window.firebaseModules;
                                const userDocRef = doc(window.firebaseDb, 'users', authUser.uid);
                                const userDoc = await getDoc(userDocRef);
                                
                                if (userDoc.exists()) {
                                    const firestoreData = userDoc.data();
                                    console.log('‚úÖ Loaded user data from Firestore:', firestoreData);
                                    
                                    setUser({
                                        uid: authUser.uid,
                                        email: authUser.email,
                                        ...firestoreData
                                    });
                                } else {
                                    // Fallback: search by email or username
                                    console.log('‚ö†Ô∏è User doc not found with UID, searching...');
                                    const { collection, query, where, getDocs } = window.firebaseModules;
                                    const usersRef = collection(window.firebaseDb, 'users');
                                    
                                    const emailQuery = query(usersRef, where('email', '==', authUser.email));
                                    const snapshot = await getDocs(emailQuery);
                                    
                                    if (!snapshot.empty) {
                                        const userData = snapshot.docs[0].data();
                                        console.log('‚úÖ Found user by email:', userData);
                                        setUser({
                                            uid: authUser.uid,
                                            email: authUser.email,
                                            ...userData
                                        });
                                    } else {
                                        setUser({
                                            uid: authUser.uid,
                                            email: authUser.email,
                                            username: authUser.displayName || 'User',
                                            isAdmin: false
                                        });
                                    }
                                }
                            } catch (error) {
                                console.error('Error loading user data:', error);
                                setUser({
                                    uid: authUser.uid,
                                    email: authUser.email,
                                    username: authUser.displayName || 'User',
                                    isAdmin: false
                                });
                            }
                        } else {
                            setUser(null);
                        }
                        setLoading(false);
                    }
                );

                return () => unsubscribe();
            }, []);

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>Loading Fantasy Cricket...</p>
                    </div>
                );
            }

            if (!user) {
                return <LoginForm />;
            }

            return user.isAdmin ? <AdminDashboard user={user} /> : <UserDashboard user={user} />;
        }

        function LoginForm() {
            const [identifier, setIdentifier] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setSuccess('');
                setLoading(true);

                try {
                    const { collection, query, where, getDocs, signInWithEmailAndPassword, createUserWithEmailAndPassword, doc, setDoc } = window.firebaseModules;
                    
                    console.log('üîç Step 1: Searching for user:', identifier);
                    
                    // Query Firestore for user
                    let userData = null;
                    let userDocId = null;
                    const usersRef = collection(window.firebaseDb, 'users');
                    
                    // Try username
                    const usernameQuery = query(usersRef, where('username', '==', identifier));
                    const usernameSnapshot = await getDocs(usernameQuery);

                    if (!usernameSnapshot.empty) {
                        userDocId = usernameSnapshot.docs[0].id;
                        userData = usernameSnapshot.docs[0].data();
                        console.log('‚úÖ Found user by username:', userData);
                    } else {
                        // Try email
                        const emailQuery = query(usersRef, where('email', '==', identifier));
                        const emailSnapshot = await getDocs(emailQuery);
                        
                        if (!emailSnapshot.empty) {
                            userDocId = emailSnapshot.docs[0].id;
                            userData = emailSnapshot.docs[0].data();
                            console.log('‚úÖ Found user by email:', userData);
                        }
                    }

                    if (!userData) {
                        setError('User not found. Please check your username/email.');
                        setLoading(false);
                        return;
                    }

                    console.log('üîç Step 2: Verifying password...');
                    
                    // Verify password
                    if (userData.password !== password) {
                        setError('Incorrect password. Please try again.');
                        setLoading(false);
                        return;
                    }
                    
                    console.log('‚úÖ Password verified!');
                    console.log('isAdmin status:', userData.isAdmin);

                    // Sign in to Firebase Auth
                    const email = userData.email || `${userData.username}@fantasy.local`;
                    
                    try {
                        const userCred = await signInWithEmailAndPassword(window.firebaseAuth, email, password);
                        console.log('‚úÖ Signed in with Firebase Auth');
                        
                        // Update Firestore with auth UID if needed
                        if (userDocId !== userCred.user.uid) {
                            const userRef = doc(window.firebaseDb, 'users', userCred.user.uid);
                            await setDoc(userRef, {
                                ...userData,
                                uid: userCred.user.uid
                            });
                            console.log('‚úÖ User data synced with auth UID');
                        }
                        
                        setSuccess('Logged in successfully!');
                    } catch (signInError) {
                        console.log('‚ö†Ô∏è Sign-in failed, creating account:', signInError.code);
                        
                        if (signInError.code === 'auth/user-not-found' || signInError.code === 'auth/invalid-credential') {
                            const userCredential = await createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                            console.log('‚úÖ Firebase Auth account created');
                            
                            // Store user data with auth UID
                            const userRef = doc(window.firebaseDb, 'users', userCredential.user.uid);
                            await setDoc(userRef, {
                                ...userData,
                                uid: userCredential.user.uid
                            });
                            console.log('‚úÖ User data saved with auth UID');
                            
                            setSuccess('Account created and logged in successfully!');
                        } else {
                            throw signInError;
                        }
                    }

                } catch (error) {
                    console.error('‚ùå Login error:', error);
                    setError(`Error: ${error.code || error.message || 'Login failed'}`);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-container">
                    <h2>üèè T20 World Cup Fantasy</h2>
                    
                    <div className="info-box">
                        <strong>‚úÖ Firebase Connected!</strong><br />
                        Login with your username or email from Firestore database.
                    </div>

                    {error && <div className="error-message">{error}</div>}
                    {success && <div className="success-message">{success}</div>}

                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>Username / Email</label>
                            <input
                                type="text"
                                value={identifier}
                                onChange={(e) => setIdentifier(e.target.value)}
                                placeholder="Enter username or email"
                                required
                                disabled={loading}
                            />
                        </div>

                        <div className="form-group">
                            <label>Password</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Enter password"
                                required
                                disabled={loading}
                            />
                        </div>

                        <button type="submit" className="btn" style={{width: '100%'}} disabled={loading}>
                            {loading ? 'Logging in...' : 'Login'}
                        </button>
                    </form>

                    <div className="info-box" style={{ marginTop: '20px', fontSize: '0.85rem' }}>
                        <strong>üìù Test Credentials:</strong><br />
                        Admin: username="admin", password="admin123"<br />
                        User: username="test", password="@j234"
                    </div>
                </div>
            );
        }

        // ADMIN DASHBOARD - Will continue in next part due to length
        function AdminDashboard({ user }) {
            const [activeTab, setActiveTab] = useState('contests');
            const [contests, setContests] = useState([]);
            const [loading, setLoading] = useState(true);

            const handleLogout = async () => {
                try {
                    await window.firebaseModules.signOut(window.firebaseAuth);
                    window.location.reload();
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Failed to logout. Please try again.');
                }
            };

            useEffect(() => {
                loadContests();
            }, []);

            const loadContests = async () => {
                try {
                    const { collection, getDocs } = window.firebaseModules;
                    const contestsRef = collection(window.firebaseDb, 'contests');
                    const snapshot = await getDocs(contestsRef);
                    
                    const contestsList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setContests(contestsList);
                    console.log('Loaded contests:', contestsList);
                } catch (error) {
                    console.error('Error loading contests:', error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <>
                    <div className="header">
                        <div className="user-badge">
                            üë§ {user.username}
                            <span className="admin-badge">Admin</span>
                        </div>
                        <h1>‚ö° T20 WORLD CUP 2026</h1>
                        <button className="logout-btn" onClick={handleLogout}>
                            Logout
                        </button>
                    </div>

                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'contests' ? 'active' : ''}`}
                            onClick={() => setActiveTab('contests')}
                        >
                            üìã Contests
                        </button>
                        <button 
                            className={`tab ${activeTab === 'create' ? 'active' : ''}`}
                            onClick={() => setActiveTab('create')}
                        >
                            ‚ú® Create Contest
                        </button>
                        <button 
                            className={`tab ${activeTab === 'matches' ? 'active' : ''}`}
                            onClick={() => setActiveTab('matches')}
                        >
                            üèÜ Matches
                        </button>
                        <button 
                            className={`tab ${activeTab === 'users' ? 'active' : ''}`}
                            onClick={() => setActiveTab('users')}
                        >
                            üë• Users
                        </button>
                    </div>

                    {activeTab === 'contests' && <ContestsList contests={contests} onRefresh={loadContests} />}
                    {activeTab === 'create' && <CreateContest onSuccess={loadContests} />}
                    {activeTab === 'matches' && <MatchesManagement />}
                    {activeTab === 'users' && <UsersManagement />}
                </>
            );
        }

        function ContestsList({ contests, onRefresh }) {
            if (contests.length === 0) {
                return (
                    <div className="card">
                        <h2>üìã All Contests</h2>
                        <p style={{ textAlign: 'center', padding: '40px', color: '#94a3b8' }}>
                            No contests created yet. Create your first contest to get started!
                        </p>
                    </div>
                );
            }

            return (
                <div className="card">
                    <h2>üìã All Contests ({contests.length})</h2>
                    <div className="contest-list">
                        {contests.map(contest => (
                            <div key={contest.id} className="contest-item">
                                <div className="contest-header">
                                    <div className="contest-title">{contest.name}</div>
                                    <span className={`contest-status status-${contest.status || 'upcoming'}`}>
                                        {contest.status || 'upcoming'}
                                    </span>
                                </div>
                                
                                <p style={{ color: '#cbd5e1', marginBottom: '15px' }}>
                                    {contest.description}
                                </p>

                                <div className="contest-info">
                                    <div className="info-item">
                                        <span className="info-icon">üèè</span>
                                        <span>{contest.matchesCount || 0} Matches</span>
                                    </div>
                                    <div className="info-item">
                                        <span className="info-icon">üë•</span>
                                        <span>{contest.participantsCount || 0} Participants</span>
                                    </div>
                                    <div className="info-item">
                                        <span className="info-icon">üìÖ</span>
                                        <span>{contest.startDate} - {contest.endDate}</span>
                                    </div>
                                </div>

                                <div className="contest-actions">
                                    <button className="btn btn-small">View Details</button>
                                    <button className="btn btn-small btn-secondary">Edit</button>
                                    <button className="btn btn-small btn-danger">Delete</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function CreateContest({ onSuccess }) {
            const [formData, setFormData] = useState({
                name: '',
                description: '',
                startDate: '',
                endDate: '',
                status: 'upcoming'
            });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                setSuccess('');

                try {
                    const { collection, addDoc } = window.firebaseModules;
                    const contestsRef = collection(window.firebaseDb, 'contests');
                    
                    await addDoc(contestsRef, {
                        ...formData,
                        createdAt: new Date().toISOString(),
                        matchesCount: 0,
                        participantsCount: 0
                    });

                    setSuccess('Contest created successfully!');
                    setFormData({
                        name: '',
                        description: '',
                        startDate: '',
                        endDate: '',
                        status: 'upcoming'
                    });

                    setTimeout(() => {
                        onSuccess();
                    }, 1500);

                } catch (error) {
                    console.error('Error creating contest:', error);
                    setError('Failed to create contest. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <div className="card">
                    <h2>‚ú® Create New Contest</h2>
                    
                    {error && <div className="error-message">{error}</div>}
                    {success && <div className="success-message">{success}</div>}

                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Contest Name *</label>
                            <input
                                type="text"
                                name="name"
                                value={formData.name}
                                onChange={handleChange}
                                placeholder="e.g., T20 World Cup 2026 - Group Stage"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label>Description *</label>
                            <textarea
                                name="description"
                                value={formData.description}
                                onChange={handleChange}
                                placeholder="Describe the contest..."
                                required
                            />
                        </div>

                        <div className="form-grid">
                            <div className="form-group">
                                <label>Start Date *</label>
                                <input
                                    type="date"
                                    name="startDate"
                                    value={formData.startDate}
                                    onChange={handleChange}
                                    required
                                />
                            </div>

                            <div className="form-group">
                                <label>End Date *</label>
                                <input
                                    type="date"
                                    name="endDate"
                                    value={formData.endDate}
                                    onChange={handleChange}
                                    required
                                />
                            </div>

                            <div className="form-group">
                                <label>Status</label>
                                <select
                                    name="status"
                                    value={formData.status}
                                    onChange={handleChange}
                                >
                                    <option value="upcoming">Upcoming</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" className="btn" disabled={loading}>
                            {loading ? 'Creating...' : 'Create Contest'}
                        </button>
                    </form>
                </div>
            );
        }

        function MatchesManagement() {
            const [matches, setMatches] = useState([]);
            const [showAddForm, setShowAddForm] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadMatches();
            }, []);

            const loadMatches = async () => {
                try {
                    const { collection, getDocs } = window.firebaseModules;
                    const matchesRef = collection(window.firebaseDb, 'matches');
                    const snapshot = await getDocs(matchesRef);
                    
                    const matchesList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setMatches(matchesList);
                } catch (error) {
                    console.error('Error loading matches:', error);
                } finally {
                    setLoading(false);
                }
            };

            const sampleMatches = [
                {
                    team1: 'India',
                    team2: 'Pakistan',
                    date: '2026-02-15',
                    time: '19:30',
                    venue: 'R. Premadasa Stadium, Colombo',
                    status: 'upcoming'
                },
                {
                    team1: 'England',
                    team2: 'Australia',
                    date: '2026-02-16',
                    time: '15:00',
                    venue: 'Eden Gardens, Kolkata',
                    status: 'upcoming'
                },
                {
                    team1: 'South Africa',
                    team2: 'New Zealand',
                    date: '2026-02-17',
                    time: '19:30',
                    venue: 'Wankhede Stadium, Mumbai',
                    status: 'upcoming'
                },
                {
                    team1: 'India',
                    team2: 'England',
                    date: '2026-02-18',
                    time: '19:30',
                    venue: 'M. Chinnaswamy Stadium, Bangalore',
                    status: 'upcoming'
                },
                {
                    team1: 'Pakistan',
                    team2: 'Australia',
                    date: '2026-02-19',
                    time: '15:00',
                    venue: 'Narendra Modi Stadium, Ahmedabad',
                    status: 'upcoming'
                }
            ];

            const addSampleMatches = async () => {
                try {
                    const { collection, addDoc } = window.firebaseModules;
                    const matchesRef = collection(window.firebaseDb, 'matches');
                    
                    for (const match of sampleMatches) {
                        await addDoc(matchesRef, {
                            ...match,
                            createdAt: new Date().toISOString()
                        });
                    }
                    
                    alert('Sample matches added successfully!');
                    loadMatches();
                } catch (error) {
                    console.error('Error adding matches:', error);
                    alert('Failed to add matches. Please try again.');
                }
            };

            const deleteMatch = async (matchId) => {
                if (!confirm('Are you sure you want to delete this match?')) return;
                
                try {
                    const { doc, deleteDoc } = window.firebaseModules;
                    await deleteDoc(doc(window.firebaseDb, 'matches', matchId));
                    alert('Match deleted successfully!');
                    loadMatches();
                } catch (error) {
                    console.error('Error deleting match:', error);
                    alert('Failed to delete match.');
                }
            };

            return (
                <div className="card">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h2>üèÜ Matches Management</h2>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            {matches.length === 0 && (
                                <button className="btn btn-small" onClick={addSampleMatches}>
                                    Add Sample Matches
                                </button>
                            )}
                            <button className="btn btn-small" onClick={() => setShowAddForm(!showAddForm)}>
                                {showAddForm ? 'Cancel' : '+ Add Match'}
                            </button>
                        </div>
                    </div>

                    {showAddForm && <AddMatchForm onSuccess={() => { setShowAddForm(false); loadMatches(); }} />}
                    
                    {loading ? (
                        <div className="loading">Loading matches...</div>
                    ) : matches.length === 0 ? (
                        <p style={{ textAlign: 'center', padding: '40px', color: '#94a3b8' }}>
                            No matches added yet. Click "Add Sample Matches" or "Add Match" to get started.
                        </p>
                    ) : (
                        <div className="match-list">
                            {matches.map(match => (
                                <div key={match.id} className="match-item">
                                    <div className="match-teams">
                                        <span className="team">{match.team1}</span>
                                        <span className="vs">VS</span>
                                        <span className="team">{match.team2}</span>
                                    </div>
                                    <div className="match-details">
                                        <span>üìÖ {match.date}</span>
                                        <span>üèüÔ∏è {match.venue}</span>
                                        <span>‚è∞ {match.time}</span>
                                        <span className={`contest-status status-${match.status || 'upcoming'}`}>
                                            {match.status || 'upcoming'}
                                        </span>
                                    </div>
                                    <div className="contest-actions" style={{ marginTop: '15px' }}>
                                        <button className="btn btn-small btn-secondary">Edit</button>
                                        <button className="btn btn-small btn-danger" onClick={() => deleteMatch(match.id)}>
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function AddMatchForm({ onSuccess }) {
            const [formData, setFormData] = useState({
                team1: '',
                team2: '',
                date: '',
                time: '',
                venue: '',
                status: 'upcoming'
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                try {
                    const { collection, addDoc } = window.firebaseModules;
                    const matchesRef = collection(window.firebaseDb, 'matches');
                    
                    await addDoc(matchesRef, {
                        ...formData,
                        createdAt: new Date().toISOString()
                    });

                    alert('Match added successfully!');
                    onSuccess();
                } catch (error) {
                    console.error('Error adding match:', error);
                    alert('Failed to add match. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const teams = Object.values(WORLD_CUP_TEAMS);

            return (
                <form onSubmit={handleSubmit} style={{ background: 'rgba(15, 23, 42, 0.6)', padding: '25px', borderRadius: '15px', marginBottom: '25px' }}>
                    <h3 style={{ color: '#10b981', marginBottom: '20px' }}>Add New Match</h3>
                    
                    <div className="form-grid">
                        <div className="form-group">
                            <label>Team 1 *</label>
                            <select
                                name="team1"
                                value={formData.team1}
                                onChange={handleChange}
                                required
                            >
                                <option value="">Select Team 1</option>
                                {teams.map(team => (
                                    <option key={team} value={team}>{team}</option>
                                ))}
                            </select>
                        </div>

                        <div className="form-group">
                            <label>Team 2 *</label>
                            <select
                                name="team2"
                                value={formData.team2}
                                onChange={handleChange}
                                required
                            >
                                <option value="">Select Team 2</option>
                                {teams.map(team => (
                                    <option key={team} value={team}>{team}</option>
                                ))}
                            </select>
                        </div>

                        <div className="form-group">
                            <label>Date *</label>
                            <input
                                type="date"
                                name="date"
                                value={formData.date}
                                onChange={handleChange}
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label>Time *</label>
                            <input
                                type="time"
                                name="time"
                                value={formData.time}
                                onChange={handleChange}
                                required
                            />
                        </div>
                    </div>

                    <div className="form-group">
                        <label>Venue *</label>
                        <input
                            type="text"
                            name="venue"
                            value={formData.venue}
                            onChange={handleChange}
                            placeholder="e.g., Eden Gardens, Kolkata"
                            required
                        />
                    </div>

                    <button type="submit" className="btn" disabled={loading}>
                        {loading ? 'Adding...' : 'Add Match'}
                    </button>
                </form>
            );
        }

        function UsersManagement() {
            return (
                <div className="card">
                    <h2>üë• Users Management</h2>
                    <p style={{ textAlign: 'center', padding: '40px', color: '#94a3b8' }}>
                        User management features coming soon...
                    </p>
                </div>
            );
        }

        // USER DASHBOARD
        function UserDashboard({ user }) {
            const [activeTab, setActiveTab] = useState('contests');
            const [contests, setContests] = useState([]);
            const [matches, setMatches] = useState([]);

            const handleLogout = async () => {
                try {
                    await window.firebaseModules.signOut(window.firebaseAuth);
                    window.location.reload();
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Failed to logout. Please try again.');
                }
            };

            useEffect(() => {
                loadContests();
                loadMatches();
            }, []);

            const loadContests = async () => {
                try {
                    const { collection, getDocs } = window.firebaseModules;
                    const contestsRef = collection(window.firebaseDb, 'contests');
                    const snapshot = await getDocs(contestsRef);
                    
                    const contestsList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setContests(contestsList.filter(c => c.status === 'active' || c.status === 'upcoming'));
                } catch (error) {
                    console.error('Error loading contests:', error);
                }
            };

            const loadMatches = async () => {
                try {
                    const { collection, getDocs } = window.firebaseModules;
                    const matchesRef = collection(window.firebaseDb, 'matches');
                    const snapshot = await getDocs(matchesRef);
                    
                    const matchesList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setMatches(matchesList.filter(m => m.status === 'upcoming' || m.status === 'active'));
                } catch (error) {
                    console.error('Error loading matches:', error);
                }
            };

            return (
                <>
                    <div className="header">
                        <div className="user-badge">
                            üë§ {user.username}
                            <span style={{ 
                                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                                color: 'white',
                                padding: '4px 12px',
                                borderRadius: '12px',
                                fontSize: '0.75rem',
                                fontWeight: '700',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                marginLeft: '8px'
                            }}>
                                User
                            </span>
                        </div>
                        <h1>‚ö° T20 WORLD CUP 2026</h1>
                        <button className="logout-btn" onClick={handleLogout}>
                            Logout
                        </button>
                    </div>

                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'matches' ? 'active' : ''}`}
                            onClick={() => setActiveTab('matches')}
                        >
                            üèè Matches
                        </button>
                        <button 
                            className={`tab ${activeTab === 'contests' ? 'active' : ''}`}
                            onClick={() => setActiveTab('contests')}
                        >
                            üèÜ Contests
                        </button>
                        <button 
                            className={`tab ${activeTab === 'myteams' ? 'active' : ''}`}
                            onClick={() => setActiveTab('myteams')}
                        >
                            üë• My Teams
                        </button>
                        <button 
                            className={`tab ${activeTab === 'leaderboard' ? 'active' : ''}`}
                            onClick={() => setActiveTab('leaderboard')}
                        >
                            üìä Leaderboard
                        </button>
                    </div>

                    {activeTab === 'matches' && <UserMatches matches={matches} user={user} />}
                    {activeTab === 'contests' && <UserContests contests={contests} user={user} />}
                    {activeTab === 'myteams' && <MyTeams user={user} />}
                    {activeTab === 'leaderboard' && <Leaderboard />}
                </>
            );
        }

        function UserMatches({ matches, user }) {
            const [selectedMatch, setSelectedMatch] = useState(null);

            if (selectedMatch) {
                return <CreateTeam match={selectedMatch} user={user} onBack={() => setSelectedMatch(null)} />;
            }

            return (
                <div className="card">
                    <h2>üèè Upcoming Matches</h2>
                    {matches.length === 0 ? (
                        <p style={{ textAlign: 'center', padding: '40px', color: '#94a3b8' }}>
                            No upcoming matches available. Check back later!
                        </p>
                    ) : (
                        <div className="match-list">
                            {matches.map(match => (
                                <div key={match.id} className="match-item">
                                    <div className="match-teams">
                                        <span className="team">{match.team1}</span>
                                        <span className="vs">VS</span>
                                        <span className="team">{match.team2}</span>
                                    </div>
                                    <div className="match-details">
                                        <span>üìÖ {match.date}</span>
                                        <span>üèüÔ∏è {match.venue}</span>
                                        <span>‚è∞ {match.time}</span>
                                    </div>
                                    <div className="contest-actions" style={{ marginTop: '15px' }}>
                                        <button className="btn btn-small" onClick={() => setSelectedMatch(match)}>
                                            Create Team
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function UserContests({ contests, user }) {
            const [selectedContest, setSelectedContest] = useState(null);

            if (selectedContest) {
                return <CreateTeam contest={selectedContest} user={user} onBack={() => setSelectedContest(null)} />;
            }

            return (
                <div className="card">
                    <h2>üèÜ Available Contests</h2>
                    <div className="contest-list">
                        {contests.map(contest => (
                            <div key={contest.id} className="contest-item">
                                <div className="contest-header">
                                    <div className="contest-title">{contest.name}</div>
                                    <span className={`contest-status status-${contest.status}`}>
                                        {contest.status}
                                    </span>
                                </div>
                                
                                <p style={{ color: '#cbd5e1', marginBottom: '15px' }}>
                                    {contest.description}
                                </p>

                                <div className="contest-actions">
                                    <button className="btn btn-small" onClick={() => setSelectedContest(contest)}>
                                        Create Team
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function CreateTeam({ match, user, onBack }) {
            const [selectedPlayers, setSelectedPlayers] = useState([]);
            const [captain, setCaptain] = useState(null);
            const [viceCaptain, setViceCaptain] = useState(null);
            const [roleFilter, setRoleFilter] = useState('All');

            // Get players for the two teams in the match
            const team1Code = Object.keys(WORLD_CUP_TEAMS).find(key => WORLD_CUP_TEAMS[key] === match.team1) || 'IND';
            const team2Code = Object.keys(WORLD_CUP_TEAMS).find(key => WORLD_CUP_TEAMS[key] === match.team2) || 'PAK';
            
            const team1Players = SAMPLE_PLAYERS[team1Code] || SAMPLE_PLAYERS['IND'];
            const team2Players = SAMPLE_PLAYERS[team2Code] || SAMPLE_PLAYERS['PAK'];
            
            const allPlayers = [...team1Players, ...team2Players].map((p, idx) => ({
                ...p,
                id: `player_${idx}`
            }));

            const filteredPlayers = roleFilter === 'All' 
                ? allPlayers 
                : allPlayers.filter(p => p.role === roleFilter);

            const totalCredits = selectedPlayers.reduce((sum, p) => sum + p.credits, 0);
            const remainingCredits = 100 - totalCredits;

            const team1Count = selectedPlayers.filter(p => p.team === team1Code).length;
            const team2Count = selectedPlayers.filter(p => p.team === team2Code).length;

            const roleCounts = {
                'Wicket-Keeper': selectedPlayers.filter(p => p.role === 'Wicket-Keeper').length,
                'Batsman': selectedPlayers.filter(p => p.role === 'Batsman').length,
                'All-Rounder': selectedPlayers.filter(p => p.role === 'All-Rounder').length,
                'Bowler': selectedPlayers.filter(p => p.role === 'Bowler').length
            };

            const togglePlayer = (player) => {
                const isSelected = selectedPlayers.some(p => p.id === player.id);
                
                if (isSelected) {
                    setSelectedPlayers(selectedPlayers.filter(p => p.id !== player.id));
                    if (captain === player.id) setCaptain(null);
                    if (viceCaptain === player.id) setViceCaptain(null);
                } else {
                    if (selectedPlayers.length >= 11) return;
                    if (totalCredits + player.credits > 100) return;
                    const teamCount = selectedPlayers.filter(p => p.team === player.team).length;
                    if (teamCount >= 7) return;
                    
                    setSelectedPlayers([...selectedPlayers, player]);
                }
            };

            const canSaveTeam = selectedPlayers.length === 11 && 
                                captain && 
                                viceCaptain && 
                                roleCounts['Wicket-Keeper'] >= 1 &&
                                roleCounts['Batsman'] >= 3 &&
                                roleCounts['Bowler'] >= 3 &&
                                roleCounts['All-Rounder'] >= 1;

            const saveTeam = async () => {
                if (!canSaveTeam) {
                    alert('Please ensure:\n- 11 players selected\n- Captain & Vice-Captain chosen\n- Min 1 WK, 3 BAT, 1 AR, 3 BOWL');
                    return;
                }

                try {
                    const { collection, addDoc } = window.firebaseModules;
                    const teamsRef = collection(window.firebaseDb, 'teams');
                    
                    await addDoc(teamsRef, {
                        matchId: match.id,
                        matchName: `${match.team1} vs ${match.team2}`,
                        userId: user.uid,
                        username: user.username,
                        players: selectedPlayers,
                        captain,
                        viceCaptain,
                        totalCredits,
                        createdAt: new Date().toISOString()
                    });

                    alert('Team saved successfully!');
                    onBack();
                } catch (error) {
                    console.error('Error saving team:', error);
                    alert('Failed to save team. Please try again.');
                }
            };

            return (
                <>
                    <div className="card">
                        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                            <button className="btn btn-small btn-secondary" onClick={onBack}>
                                ‚Üê Back
                            </button>
                            <h2 style={{ margin: 0 }}>{match.team1} vs {match.team2}</h2>
                        </div>
                        <p style={{ color: '#94a3b8', marginTop: '10px' }}>
                            üìÖ {match.date} | üèüÔ∏è {match.venue} | ‚è∞ {match.time}
                        </p>
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 350px', gap: '20px' }}>
                        <div className="card">
                            <h2>Select Players</h2>
                            
                            <div className="player-filters">
                                {['All', 'Wicket-Keeper', 'Batsman', 'All-Rounder', 'Bowler'].map(role => (
                                    <button
                                        key={role}
                                        className={`filter-btn ${roleFilter === role ? 'active' : ''}`}
                                        onClick={() => setRoleFilter(role)}
                                    >
                                        {role}
                                    </button>
                                ))}
                            </div>

                            <div className="players-grid">
                                {filteredPlayers.map(player => {
                                    const isSelected = selectedPlayers.some(p => p.id === player.id);
                                    const canSelect = selectedPlayers.length < 11 && 
                                                    totalCredits + player.credits <= 100 &&
                                                    selectedPlayers.filter(p => p.team === player.team).length < 7;
                                    
                                    return (
                                        <div
                                            key={player.id}
                                            className={`player-card ${isSelected ? 'selected' : ''} ${!isSelected && !canSelect ? 'disabled' : ''}`}
                                            onClick={() => togglePlayer(player)}
                                        >
                                            <div className="player-header">
                                                <div className="player-name">{player.name}</div>
                                                <div className="player-credits">{player.credits}</div>
                                            </div>
                                            <div className="player-info">
                                                <span className="player-role">{player.role}</span>
                                                <span>{WORLD_CUP_TEAMS[player.team] || player.team}</span>
                                            </div>
                                            {isSelected && (
                                                <div className="captain-controls" style={{ marginTop: '10px' }}>
                                                    <button
                                                        className={`captain-btn ${captain === player.id ? 'active' : ''}`}
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setCaptain(player.id);
                                                        }}
                                                    >
                                                        {captain === player.id ? 'üëë C' : 'C'}
                                                    </button>
                                                    <button
                                                        className={`captain-btn ${viceCaptain === player.id ? 'active' : ''}`}
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setViceCaptain(player.id);
                                                        }}
                                                    >
                                                        {viceCaptain === player.id ? '‚≠ê VC' : 'VC'}
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="team-summary">
                            <div className="summary-header">Team Summary</div>
                            
                            <div className="summary-stats">
                                <div className="stat-item">
                                    <span className="stat-label">Players</span>
                                    <span className={`stat-value ${selectedPlayers.length < 11 ? 'warning' : ''}`}>
                                        {selectedPlayers.length}/11
                                    </span>
                                </div>
                                
                                <div className="stat-item">
                                    <span className="stat-label">Credits</span>
                                    <span className={`stat-value ${remainingCredits < 0 ? 'danger' : ''}`}>
                                        {remainingCredits.toFixed(1)}/100
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">{team1Code}</span>
                                    <span className={`stat-value ${team1Count > 7 ? 'danger' : ''}`}>
                                        {team1Count}/7 max
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">{team2Code}</span>
                                    <span className={`stat-value ${team2Count > 7 ? 'danger' : ''}`}>
                                        {team2Count}/7 max
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">WK</span>
                                    <span className={`stat-value ${roleCounts['Wicket-Keeper'] < 1 ? 'warning' : ''}`}>
                                        {roleCounts['Wicket-Keeper']} (min 1)
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">BAT</span>
                                    <span className={`stat-value ${roleCounts['Batsman'] < 3 ? 'warning' : ''}`}>
                                        {roleCounts['Batsman']} (min 3)
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">AR</span>
                                    <span className={`stat-value ${roleCounts['All-Rounder'] < 1 ? 'warning' : ''}`}>
                                        {roleCounts['All-Rounder']} (min 1)
                                    </span>
                                </div>

                                <div className="stat-item">
                                    <span className="stat-label">BOWL</span>
                                    <span className={`stat-value ${roleCounts['Bowler'] < 3 ? 'warning' : ''}`}>
                                        {roleCounts['Bowler']} (min 3)
                                    </span>
                                </div>
                            </div>

                            <div className="selected-players-list">
                                <strong style={{ color: '#10b981', marginBottom: '10px', display: 'block' }}>
                                    Selected Players
                                </strong>
                                {selectedPlayers.length === 0 ? (
                                    <p style={{ color: '#94a3b8', fontSize: '0.9rem' }}>No players selected yet</p>
                                ) : (
                                    selectedPlayers.map(player => (
                                        <div key={player.id} className="selected-player">
                                            <span>
                                                {player.name}
                                                {captain === player.id && ' üëë'}
                                                {viceCaptain === player.id && ' ‚≠ê'}
                                            </span>
                                            <span>{player.credits}</span>
                                        </div>
                                    ))
                                )}
                            </div>

                            <button 
                                className="btn" 
                                style={{ width: '100%', marginTop: '20px' }}
                                disabled={!canSaveTeam}
                                onClick={saveTeam}
                            >
                                Save Team
                            </button>

                            {!canSaveTeam && selectedPlayers.length > 0 && (
                                <p style={{ color: '#f59e0b', fontSize: '0.85rem', marginTop: '10px', textAlign: 'center' }}>
                                    {selectedPlayers.length < 11 && '‚ö†Ô∏è Select 11 players\n'}
                                    {!captain && '‚ö†Ô∏è Choose Captain\n'}
                                    {!viceCaptain && '‚ö†Ô∏è Choose Vice-Captain\n'}
                                    {roleCounts['Wicket-Keeper'] < 1 && '‚ö†Ô∏è Need 1 WK\n'}
                                    {roleCounts['Batsman'] < 3 && '‚ö†Ô∏è Need 3 BAT\n'}
                                    {roleCounts['All-Rounder'] < 1 && '‚ö†Ô∏è Need 1 AR\n'}
                                    {roleCounts['Bowler'] < 3 && '‚ö†Ô∏è Need 3 BOWL'}
                                </p>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        function MyTeams({ user }) {
            const [teams, setTeams] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadTeams();
            }, []);

            const loadTeams = async () => {
                try {
                    const { collection, query, where, getDocs } = window.firebaseModules;
                    const teamsRef = collection(window.firebaseDb, 'teams');
                    const q = query(teamsRef, where('userId', '==', user.uid));
                    const snapshot = await getDocs(q);
                    
                    const teamsList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    setTeams(teamsList);
                } catch (error) {
                    console.error('Error loading teams:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="card">
                        <h2>üë• My Teams</h2>
                        <div className="loading">Loading your teams...</div>
                    </div>
                );
            }

            return (
                <div className="card">
                    <h2>üë• My Teams ({teams.length})</h2>
                    {teams.length === 0 ? (
                        <p style={{ textAlign: 'center', padding: '40px', color: '#94a3b8' }}>
                            No teams created yet. Go to Matches to create your first team!
                        </p>
                    ) : (
                        <div className="contest-list">
                            {teams.map(team => (
                                <div key={team.id} className="contest-item">
                                    <div className="contest-header">
                                        <div className="contest-title">{team.matchName}</div>
                                        <span style={{ color: '#10b981', fontWeight: '700' }}>
                                            {team.totalCredits.toFixed(1)} Credits
                                        </span>
                                    </div>
                                    
                                    <div style={{ marginTop: '15px' }}>
                                        <strong style={{ color: '#cbd5e1' }}>Team Players:</strong>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '10px', marginTop: '10px' }}>
                                            {team.players.map(player => (
                                                <div key={player.id} style={{ 
                                                    padding: '10px', 
                                                    background: 'rgba(15, 23, 42, 0.6)', 
                                                    borderRadius: '8px',
                                                    fontSize: '0.9rem'
                                                }}>
                                                    <div style={{ fontWeight: '600', color: '#fff' }}>
                                                        {player.name}
                                                        {team.captain === player.id && ' üëë'}
                                                        {team.viceCaptain === player.id && ' ‚≠ê'}
                                                    </div>
                                                    <div style={{ color: '#94a3b8', fontSize: '0.85rem', marginTop: '4px' }}>
                                                        {player.role} ‚Ä¢ {player.credits} Cr
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function Leaderboard() {
            const sampleData = [
                { rank: 1, username: 'cricket_king', points: 1250, teams: 3 },
                { rank: 2, username: 'fantasy_pro', points: 1180, teams: 2 },
                { rank: 3, username: 'world_cup_fan', points: 1120, teams: 4 },
                { rank: 4, username: 'player123', points: 980, teams: 2 },
                { rank: 5, username: 'sports_master', points: 850, teams: 3 }
            ];

            return (
                <div className="card">
                    <h2>üìä Leaderboard</h2>
                    <table className="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Username</th>
                                <th>Points</th>
                                <th>Teams</th>
                            </tr>
                        </thead>
                        <tbody>
                            {sampleData.map(entry => (
                                <tr key={entry.rank}>
                                    <td>
                                        <span className={`rank-badge rank-${entry.rank <= 3 ? entry.rank : 'other'}`}>
                                            {entry.rank}
                                        </span>
                                    </td>
                                    <td style={{ fontWeight: 600 }}>{entry.username}</td>
                                    <td style={{ color: '#10b981', fontWeight: 700 }}>{entry.points}</td>
                                    <td>{entry.teams}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
