<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T20 World Cup 2026 Fantasy League</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs, addDoc, orderBy, Timestamp, doc, updateDoc, deleteDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDacks7Qnk42D2898leU_kgG8DZsYTFxCw",
            authDomain: "t20-fantasy-contest.firebaseapp.com",
            projectId: "t20-fantasy-contest",
            storageBucket: "t20-fantasy-contest.firebasestorage.app",
            messagingSenderId: "180217303236",
            appId: "1:180217303236:web:a6b078a7a7d0fa070c3991",
            measurementId: "G-LYY944KN99"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.firebaseDb = db;
        window.firebaseModules = {
            collection, query, where, getDocs, addDoc, orderBy, Timestamp, doc, updateDoc, deleteDoc, setDoc
        };
        window.firebaseReady = true;
        
        console.log("‚úÖ Firebase initialized");
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: #0a0e1a;
            color: #e0e6ed;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0a0e1a 0%, #0f1729 100%);
            pointer-events: none;
            z-index: 0;
        }
        
        #root {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            padding: 40px 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .user-badge {
            position: absolute;
            top: 20px;
            left: 30px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .admin-badge {
            background: rgba(239, 68, 68, 0.3);
            margin-left: 10px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .logout-btn:hover { background: rgba(255,255,255,0.3); }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            background: #1a1f2e;
            border: 2px solid transparent;
            border-radius: 12px;
            color: #8b92a7;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-color: #10b981;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .card {
            background: #151a2b;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid #2a3142;
        }

        .card h2 {
            font-family: 'Orbitron', sans-serif;
            color: #10b981;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .match-list { display: grid; gap: 20px; }

        .match-card {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #2a3142;
            cursor: pointer;
            transition: all 0.3s;
        }

        .match-card:hover {
            border-color: #10b981;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .teams {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: #e0e6ed;
        }

        .match-info {
            display: flex;
            gap: 20px;
            color: #8b92a7;
            font-size: 0.9rem;
        }

        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .btn:disabled {
            background: #4b5563;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.2rem;
            color: #10b981;
        }

        .error-display {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            color: #fca5a5;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .success-display {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
            color: #6ee7b7;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .validation-errors {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .validation-errors h4 {
            color: #fca5a5;
            margin-bottom: 10px;
        }

        .validation-errors ul {
            color: #fca5a5;
            margin-left: 20px;
        }

        .team-summary {
            background: #1a1f2e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            color: #8b92a7;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .summary-value {
            color: #10b981;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            background: #1a1f2e;
            border: 2px solid #2a3142;
            border-radius: 10px;
            color: #e0e6ed;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #10b981;
        }

        .role-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .role-tab {
            padding: 10px 20px;
            background: #1a1f2e;
            border: 2px solid #2a3142;
            border-radius: 8px;
            color: #8b92a7;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .role-tab.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .player-card {
            background: #1a1f2e;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #2a3142;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-card:hover {
            border-color: #10b981;
            transform: translateY(-2px);
        }

        .player-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .player-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .player-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .player-team {
            color: #8b92a7;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .player-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-role {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .player-credits {
            font-weight: 700;
            color: #fbbf24;
        }

        .captain-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .captain-btn {
            flex: 1;
            padding: 6px 10px;
            background: #2a3142;
            border: 1px solid #3b4252;
            border-radius: 6px;
            color: #8b92a7;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .captain-btn:hover {
            background: #3b4252;
        }

        .captain-btn.active-captain {
            background: #fbbf24;
            color: #0a0e1a;
            border-color: #fbbf24;
            font-weight: 700;
        }

        .captain-btn.active-vc {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            font-weight: 700;
        }

        /* Admin Panel Styles */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th {
            background: #1a1f2e;
            padding: 12px;
            text-align: left;
            color: #10b981;
            font-weight: 600;
            border-bottom: 2px solid #2a3142;
        }

        .admin-table td {
            padding: 12px;
            border-bottom: 1px solid #2a3142;
        }

        .admin-table tr:hover {
            background: rgba(16, 185, 129, 0.05);
        }

        .admin-input {
            width: 70px;
            padding: 8px;
            background: #1a1f2e;
            border: 2px solid #2a3142;
            border-radius: 6px;
            color: #e0e6ed;
            text-align: center;
        }

        .admin-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .points-cell {
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Leaderboard Styles */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th {
            background: #1a1f2e;
            padding: 15px;
            text-align: left;
            color: #10b981;
            font-weight: 600;
            border-bottom: 2px solid #2a3142;
        }

        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid #2a3142;
        }

        .leaderboard-table tr:hover {
            background: rgba(16, 185, 129, 0.05);
        }

        .rank-cell {
            font-weight: 700;
            font-size: 1.3rem;
            text-align: center;
            width: 80px;
        }

        .has-team-badge {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .user-badge, .logout-btn { position: static; margin: 10px 0; }
            .admin-table, .leaderboard-table { font-size: 0.9rem; }
            .admin-input { width: 50px; padding: 5px; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock data - Replace with your actual data
        const MOCK_MATCHES = [
            { id: 'IND_vs_PAK', team1: 'IND', team2: 'PAK', venue: 'Melbourne', date: '2026-03-15', status: 'upcoming' },
            { id: 'AUS_vs_ENG', team1: 'AUS', team2: 'ENG', venue: 'Sydney', date: '2026-03-16', status: 'upcoming' },
            { id: 'SA_vs_NZ', team1: 'SA', team2: 'NZ', venue: 'Brisbane', date: '2026-03-17', status: 'upcoming' }
        ];

        const MOCK_PLAYERS = [
            { id: 'p1', matchId: 'IND_vs_PAK', name: 'Virat Kohli', team: 'IND', role: 'BAT', credits: 11.0 },
            { id: 'p2', matchId: 'IND_vs_PAK', name: 'Rohit Sharma', team: 'IND', role: 'BAT', credits: 10.5 },
            { id: 'p3', matchId: 'IND_vs_PAK', name: 'Jasprit Bumrah', team: 'IND', role: 'BOWL', credits: 10.0 },
            { id: 'p4', matchId: 'IND_vs_PAK', name: 'Hardik Pandya', team: 'IND', role: 'AR', credits: 9.5 },
            { id: 'p5', matchId: 'IND_vs_PAK', name: 'Rishabh Pant', team: 'IND', role: 'WK', credits: 9.0 },
            { id: 'p6', matchId: 'IND_vs_PAK', name: 'Babar Azam', team: 'PAK', role: 'BAT', credits: 10.5 },
            { id: 'p7', matchId: 'IND_vs_PAK', name: 'Mohammad Rizwan', team: 'PAK', role: 'WK', credits: 9.0 },
            { id: 'p8', matchId: 'IND_vs_PAK', name: 'Shaheen Afridi', team: 'PAK', role: 'BOWL', credits: 9.5 },
            { id: 'p9', matchId: 'IND_vs_PAK', name: 'Shadab Khan', team: 'PAK', role: 'AR', credits: 8.5 },
            { id: 'p10', matchId: 'IND_vs_PAK', name: 'Fakhar Zaman', team: 'PAK', role: 'BAT', credits: 9.0 },
            { id: 'p11', matchId: 'IND_vs_PAK', name: 'Ravindra Jadeja', team: 'IND', role: 'AR', credits: 9.0 },
            { id: 'p12', matchId: 'IND_vs_PAK', name: 'Mohammed Shami', team: 'IND', role: 'BOWL', credits: 8.5 }
        ];

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('matches');

            useEffect(() => {
                checkFirebase();
            }, []);

            const checkFirebase = () => {
                const interval = setInterval(() => {
                    if (window.firebaseReady) {
                        // Mock user - in production, use Firebase Auth
                        setUser({
                            uid: 'user_' + Math.random().toString(36).substr(2, 9),
                            displayName: 'Test User',
                            isAdmin: false // Set to true to test admin features
                        });
                        clearInterval(interval);
                    }
                }, 100);
            };

            const handleLogout = () => {
                setUser(null);
                setActiveTab('matches');
            };

            if (!user) {
                return (
                    <div className="header">
                        <h1>T20 Fantasy League</h1>
                        <div className="loading">Loading...</div>
                    </div>
                );
            }

            return (
                <div>
                    <div className="header">
                        <div className="user-badge">
                            üë§ {user.displayName}
                            {user.isAdmin && <span className="admin-badge">ADMIN</span>}
                        </div>
                        <h1>üèè T20 Fantasy League</h1>
                        <button onClick={handleLogout} className="logout-btn">Logout</button>
                    </div>

                    <div className="tabs">
                        <div className={`tab ${activeTab === 'matches' ? 'active' : ''}`} onClick={() => setActiveTab('matches')}>
                            Matches
                        </div>
                        <div className={`tab ${activeTab === 'myteams' ? 'active' : ''}`} onClick={() => setActiveTab('myteams')}>
                            My Teams
                        </div>
                        <div className={`tab ${activeTab === 'leaderboard' ? 'active' : ''}`} onClick={() => setActiveTab('leaderboard')}>
                            Leaderboard
                        </div>
                        {user.isAdmin && (
                            <div className={`tab ${activeTab === 'admin' ? 'active' : ''}`} onClick={() => setActiveTab('admin')}>
                                Admin Panel
                            </div>
                        )}
                    </div>

                    {activeTab === 'matches' && <MatchesTab user={user} />}
                    {activeTab === 'myteams' && <MyTeamsTab user={user} />}
                    {activeTab === 'leaderboard' && <LeaderboardTab user={user} />}
                    {activeTab === 'admin' && user.isAdmin && <AdminPanel user={user} />}
                </div>
            );
        }

        function MatchesTab({ user }) {
            const [matches, setMatches] = useState([]);
            const [selectedMatch, setSelectedMatch] = useState(null);
            const [loading, setLoading] = useState(true);
            const [userTeams, setUserTeams] = useState({});

            useEffect(() => {
                loadMatches();
                loadUserTeams();
            }, [user]);

            const loadMatches = async () => {
                try {
                    // In production, fetch from Firestore
                    setMatches(MOCK_MATCHES);
                } catch (error) {
                    console.error('Error loading matches:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadUserTeams = async () => {
                try {
                    const { collection, query, where, getDocs } = window.firebaseModules;
                    const teamsRef = collection(window.firebaseDb, 'userTeams');
                    const q = query(teamsRef, where('userId', '==', user.uid));
                    const snapshot = await getDocs(q);
                    
                    const teamsMap = {};
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        teamsMap[data.matchId] = { id: doc.id, ...data };
                    });
                    setUserTeams(teamsMap);
                } catch (error) {
                    console.error('Error loading user teams:', error);
                }
            };

            const handleMatchSelect = async (match) => {
                const hasTeam = userTeams[match.id];
                if (hasTeam) {
                    alert('You already have a team for this match! Check "My Teams" tab to view it.');
                    return;
                }
                setSelectedMatch(match);
            };

            if (loading) {
                return <div className="card"><div className="loading">Loading matches...</div></div>;
            }

            if (selectedMatch) {
                return <CreateTeamTab match={selectedMatch} user={user} onBack={() => {
                    setSelectedMatch(null);
                    loadUserTeams();
                }} />;
            }

            return (
                <div className="card">
                    <h2>Upcoming Matches</h2>
                    <div className="match-list">
                        {matches.map(match => {
                            const hasTeam = userTeams[match.id];
                            return (
                                <div key={match.id} className="match-card" onClick={() => handleMatchSelect(match)}>
                                    <div className="match-header">
                                        <div className="teams">{match.team1} vs {match.team2}</div>
                                        {hasTeam && <span className="has-team-badge">‚úì Team Created</span>}
                                    </div>
                                    <div className="match-info">
                                        <span>üìç {match.venue}</span>
                                        <span>üìÖ {match.date}</span>
                                        <span>‚ö° {match.status}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        function CreateTeamTab({ match, user, onBack }) {
            const [players, setPlayers] = useState([]);
            const [selectedPlayers, setSelectedPlayers] = useState([]);
            const [captain, setCaptain] = useState(null);
            const [viceCaptain, setViceCaptain] = useState(null);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [activeRole, setActiveRole] = useState('ALL');
            const [errorMsg, setErrorMsg] = useState('');
            const [validationErrors, setValidationErrors] = useState([]);

            useEffect(() => {
                loadPlayers();
            }, [match]);

            const loadPlayers = async () => {
                try {
                    // In production, fetch from Firestore filtered by matchId
                    const matchPlayers = MOCK_PLAYERS.filter(p => p.matchId === match.id);
                    setPlayers(matchPlayers);
                } catch (error) {
                    console.error('Error loading players:', error);
                } finally {
                    setLoading(false);
                }
            };

            const togglePlayer = (player) => {
                const isSelected = selectedPlayers.find(p => p.id === player.id);
                if (isSelected) {
                    setSelectedPlayers(selectedPlayers.filter(p => p.id !== player.id));
                    if (captain === player.id) setCaptain(null);
                    if (viceCaptain === player.id) setViceCaptain(null);
                } else {
                    if (selectedPlayers.length < 11) {
                        setSelectedPlayers([...selectedPlayers, player]);
                    }
                }
                setErrorMsg('');
                setValidationErrors([]);
            };

            const validateTeam = () => {
                const errors = [];
                
                if (selectedPlayers.length !== 11) {
                    errors.push('Select exactly 11 players');
                }

                const totalCredits = selectedPlayers.reduce((sum, p) => sum + p.credits, 0);
                if (totalCredits > 100) {
                    errors.push(`Total credits (${totalCredits.toFixed(1)}) exceeds 100`);
                }

                const roleCount = {
                    WK: selectedPlayers.filter(p => p.role === 'WK').length,
                    BAT: selectedPlayers.filter(p => p.role === 'BAT').length,
                    AR: selectedPlayers.filter(p => p.role === 'AR').length,
                    BOWL: selectedPlayers.filter(p => p.role === 'BOWL').length
                };

                if (roleCount.WK < 1) errors.push('Select at least 1 Wicket Keeper');
                if (roleCount.BAT < 1) errors.push('Select at least 1 Batsman');
                if (roleCount.BOWL < 1) errors.push('Select at least 1 Bowler');

                if (!captain) errors.push('Select a Captain');
                if (!viceCaptain) errors.push('Select a Vice Captain');
                if (captain === viceCaptain && captain) errors.push('Captain and Vice Captain must be different');

                return errors;
            };

            const saveTeam = async () => {
                const errors = validateTeam();
                if (errors.length > 0) {
                    setValidationErrors(errors);
                    return;
                }

                try {
                    // Check if team already exists (validation)
                    const { collection, query, where, getDocs, addDoc, Timestamp } = window.firebaseModules;
                    const teamsRef = collection(window.firebaseDb, 'userTeams');
                    const q = query(
                        teamsRef,
                        where('userId', '==', user.uid),
                        where('matchId', '==', match.id)
                    );
                    const existingTeam = await getDocs(q);
                    
                    if (!existingTeam.empty) {
                        setErrorMsg('You already have a team for this match!');
                        return;
                    }

                    const totalCredits = selectedPlayers.reduce((sum, p) => sum + p.credits, 0);
                    
                    await addDoc(teamsRef, {
                        userId: user.uid,
                        userName: user.displayName,
                        matchId: match.id,
                        players: selectedPlayers,
                        captain: captain,
                        viceCaptain: viceCaptain,
                        totalCredits: totalCredits,
                        totalPoints: 0,
                        createdAt: Timestamp.now()
                    });

                    alert('Team saved successfully!');
                    onBack();
                } catch (error) {
                    console.error('Error saving team:', error);
                    setErrorMsg('Error saving team. Please try again.');
                }
            };

            const filteredPlayers = players.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesRole = activeRole === 'ALL' || p.role === activeRole;
                return matchesSearch && matchesRole;
            });

            const totalCredits = selectedPlayers.reduce((sum, p) => sum + p.credits, 0);
            const getRoleCount = (role) => selectedPlayers.filter(p => p.role === role).length;

            if (loading) {
                return (
                    <div className="card">
                        <button onClick={onBack} className="btn" style={{ marginBottom: '20px' }}>‚Üê Back</button>
                        <div className="loading">Loading players...</div>
                    </div>
                );
            }

            return (
                <div className="card">
                    <button onClick={onBack} className="btn" style={{ marginBottom: '20px' }}>‚Üê Back</button>
                    <h2>Create Team - {match.id}</h2>

                    {errorMsg && <div className="error-display"><strong>‚ö†Ô∏è</strong> {errorMsg}</div>}
                    {validationErrors.length > 0 && (
                        <div className="validation-errors">
                            <h4>‚ö†Ô∏è Fix these issues:</h4>
                            <ul>{validationErrors.map((e, i) => <li key={i}>{e}</li>)}</ul>
                        </div>
                    )}

                    <div className="team-summary">
                        <div className="summary-grid">
                            <div className="summary-item">
                                <div className="summary-label">Players</div>
                                <div className="summary-value">{selectedPlayers.length}/11</div>
                            </div>
                            <div className="summary-item">
                                <div className="summary-label">Credits</div>
                                <div className="summary-value" style={{ color: totalCredits > 100 ? '#ef4444' : '#10b981' }}>
                                    {totalCredits.toFixed(1)}/100
                                </div>
                            </div>
                            <div className="summary-item">
                                <div className="summary-label">WK</div>
                                <div className="summary-value">{getRoleCount('WK')}</div>
                            </div>
                            <div className="summary-item">
                                <div className="summary-label">BAT</div>
                                <div className="summary-value">{getRoleCount('BAT')}</div>
                            </div>
                            <div className="summary-item">
                                <div className="summary-label">AR</div>
                                <div className="summary-value">{getRoleCount('AR')}</div>
                            </div>
                            <div className="summary-item">
                                <div className="summary-label">BOWL</div>
                                <div className="summary-value">{getRoleCount('BOWL')}</div>
                            </div>
                        </div>
                    </div>

                    <input
                        type="text"
                        className="search-box"
                        placeholder="Search players..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                    />

                    <div className="role-tabs">
                        {['ALL', 'WK', 'BAT', 'AR', 'BOWL'].map(role => (
                            <div key={role} className={`role-tab ${activeRole === role ? 'active' : ''}`} onClick={() => setActiveRole(role)}>
                                {role}
                            </div>
                        ))}
                    </div>

                    <div className="players-grid">
                        {filteredPlayers.map(player => {
                            const isSelected = selectedPlayers.find(p => p.id === player.id);
                            const isCaptain = captain === player.id;
                            const isVC = viceCaptain === player.id;
                            const canSelect = selectedPlayers.length < 11 || isSelected;
                            
                            return (
                                <div
                                    key={player.id}
                                    className={`player-card ${isSelected ? 'selected' : ''} ${!canSelect ? 'disabled' : ''}`}
                                    onClick={() => canSelect && togglePlayer(player)}
                                >
                                    <div className="player-name">{player.name}</div>
                                    <div className="player-team">{player.team}</div>
                                    <div className="player-meta">
                                        <span className="player-role">{player.role}</span>
                                        <span className="player-credits">{player.credits} Cr</span>
                                    </div>
                                    
                                    {isSelected && (
                                        <div className="captain-buttons" onClick={(e) => e.stopPropagation()}>
                                            <button
                                                className={`captain-btn ${isCaptain ? 'active-captain' : ''}`}
                                                onClick={() => setCaptain(player.id)}
                                            >
                                                {isCaptain ? 'üëë C (2x)' : 'Captain'}
                                            </button>
                                            <button
                                                className={`captain-btn ${isVC ? 'active-vc' : ''}`}
                                                onClick={() => setViceCaptain(player.id)}
                                            >
                                                {isVC ? '‚≠ê VC (1.5x)' : 'VC'}
                                            </button>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>

                    <button onClick={saveTeam} className="btn" style={{ width: '100%', marginTop: '30px' }}>
                        Save Team
                    </button>
                </div>
            );
        }

        function MyTeamsTab({ user }) {
            const [teams, setTeams] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadTeams();
            }, [user]);

            const loadTeams = async () => {
                try {
                    const { collection, query, where, getDocs } = window.firebaseModules;
                    const teamsRef = collection(window.firebaseDb, 'userTeams');
                    const q = query(teamsRef, where('userId', '==', user.uid));
                    const snapshot = await getDocs(q);
                    
                    const teamsData = [];
                    snapshot.forEach(doc => {
                        teamsData.push({ id: doc.id, ...doc.data() });
                    });
                    
                    setTeams(teamsData);
                } catch (error) {
                    console.error('Error loading teams:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return <div className="card"><div className="loading">Loading...</div></div>;
            }

            return (
                <div className="card">
                    <h2>My Teams</h2>
                    {teams.length === 0 ? (
                        <p style={{ textAlign: 'center', padding: '40px', color: '#8b92a7' }}>
                            No teams yet. Create your first team!
                        </p>
                    ) : (
                        <div className="match-list">
                            {teams.map(team => (
                                <div key={team.id} className="match-card">
                                    <div className="match-header">
                                        <div className="teams">{team.matchId}</div>
                                        <div style={{ color: '#10b981', fontSize: '1.2rem', fontWeight: '700' }}>
                                            {team.totalPoints ? team.totalPoints.toFixed(1) : '0'} pts
                                        </div>
                                    </div>
                                    <div className="match-info">
                                        <span>Credits: {team.totalCredits?.toFixed(1)}</span>
                                        <span>{team.players?.length} Players</span>
                                    </div>
                                    <div style={{ marginTop: '15px' }}>
                                        <strong style={{ color: '#10b981' }}>Players:</strong>
                                        <div style={{ marginTop: '10px', display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))', gap: '10px' }}>
                                            {team.players?.map(p => (
                                                <div key={p.id} style={{ background: '#1a1f2e', padding: '8px', borderRadius: '6px' }}>
                                                    {p.name}
                                                    {p.id === team.captain && ' üëë'}
                                                    {p.id === team.viceCaptain && ' ‚≠ê'}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        function LeaderboardTab({ user }) {
            const [matches, setMatches] = useState([]);
            const [selectedMatch, setSelectedMatch] = useState(null);
            const [leaderboard, setLeaderboard] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadMatches();
            }, []);

            const loadMatches = async () => {
                setMatches(MOCK_MATCHES);
                setLoading(false);
            };

            const loadLeaderboard = async (matchId) => {
                setLoading(true);
                try {
                    const { collection, query, where, orderBy, getDocs } = window.firebaseModules;
                    const leaderboardRef = collection(window.firebaseDb, 'leaderboard');
                    const q = query(
                        leaderboardRef,
                        where('matchId', '==', matchId),
                        orderBy('totalPoints', 'desc')
                    );
                    const snapshot = await getDocs(q);
                    const leaderboardData = snapshot.docs.map(doc => doc.data());
                    setLeaderboard(leaderboardData);
                } catch (error) {
                    console.error('Error loading leaderboard:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (!selectedMatch) {
                return (
                    <div className="card">
                        <h2>Select Match for Leaderboard</h2>
                        <div className="match-list">
                            {matches.map(match => (
                                <div 
                                    key={match.id} 
                                    className="match-card"
                                    onClick={() => {
                                        setSelectedMatch(match);
                                        loadLeaderboard(match.id);
                                    }}
                                >
                                    <div className="teams">{match.team1} vs {match.team2}</div>
                                    <div className="match-info">
                                        <span>üìç {match.venue}</span>
                                        <span>üìÖ {match.date}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="card">
                    <button 
                        onClick={() => setSelectedMatch(null)} 
                        className="btn" 
                        style={{ marginBottom: '20px' }}
                    >
                        ‚Üê Back
                    </button>
                    <h2>Leaderboard - {selectedMatch.id}</h2>
                    
                    {loading ? (
                        <div className="loading">Loading leaderboard...</div>
                    ) : leaderboard.length === 0 ? (
                        <p style={{ textAlign: 'center', padding: '40px', color: '#8b92a7' }}>
                            No leaderboard data yet. Admin needs to update player points.
                        </p>
                    ) : (
                        <table className="leaderboard-table">
                            <thead>
                                <tr>
                                    <th style={{ width: '80px', textAlign: 'center' }}>Rank</th>
                                    <th>User</th>
                                    <th style={{ textAlign: 'right' }}>Total Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                {leaderboard.map((entry, index) => (
                                    <tr key={entry.userId} style={{ background: entry.userId === user.uid ? 'rgba(16, 185, 129, 0.1)' : 'transparent' }}>
                                        <td className="rank-cell">
                                            {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : entry.rank}
                                        </td>
                                        <td>
                                            {entry.userName}
                                            {entry.userId === user.uid && <span style={{ marginLeft: '10px', color: '#10b981' }}>(You)</span>}
                                        </td>
                                        <td className="points-cell" style={{ textAlign: 'right', color: '#10b981' }}>
                                            {entry.totalPoints.toFixed(1)}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    )}
                </div>
            );
        }

        function AdminPanel({ user }) {
            const [selectedMatch, setSelectedMatch] = useState(null);
            const [matches, setMatches] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadMatches();
            }, []);

            const loadMatches = async () => {
                setMatches(MOCK_MATCHES);
                setLoading(false);
            };

            if (!user.isAdmin) {
                return <div className="card"><h2>Access Denied - Admin Only</h2></div>;
            }

            if (selectedMatch) {
                return <AdminPlayerPoints 
                    match={selectedMatch} 
                    onBack={() => setSelectedMatch(null)} 
                    user={user}
                />;
            }

            return (
                <div className="card">
                    <h2>Admin Panel - Select Match</h2>
                    <div className="match-list">
                        {matches.map(match => (
                            <div 
                                key={match.id} 
                                className="match-card"
                                onClick={() => setSelectedMatch(match)}
                            >
                                <div className="teams">{match.team1} vs {match.team2}</div>
                                <div className="match-info">
                                    <span>üìç {match.venue}</span>
                                    <span>üìÖ {match.date}</span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function AdminPlayerPoints({ match, onBack, user }) {
            const [players, setPlayers] = useState([]);
            const [playerPoints, setPlayerPoints] = useState({});
            const [saving, setSaving] = useState(false);
            const [successMsg, setSuccessMsg] = useState('');

            useEffect(() => {
                loadPlayers();
            }, [match]);

            const loadPlayers = async () => {
                const matchPlayers = MOCK_PLAYERS.filter(p => p.matchId === match.id);
                setPlayers(matchPlayers);
                
                // Initialize points
                const initialPoints = {};
                matchPlayers.forEach(player => {
                    initialPoints[player.id] = {
                        runs: 0,
                        wickets: 0,
                        catches: 0,
                        runOuts: 0,
                        totalPoints: 0
                    };
                });
                setPlayerPoints(initialPoints);
            };

            const calculatePoints = (stats) => {
                const runsPoints = stats.runs || 0;
                const wicketsPoints = (stats.wickets || 0) * 25;
                const catchPoints = (stats.catches || 0) * 5;
                const runOutPoints = (stats.runOuts || 0) * 6;
                
                return runsPoints + wicketsPoints + catchPoints + runOutPoints;
            };

            const updatePlayerStat = (playerId, field, value) => {
                setPlayerPoints(prev => {
                    const updated = {
                        ...prev,
                        [playerId]: {
                            ...prev[playerId],
                            [field]: parseInt(value) || 0
                        }
                    };
                    updated[playerId].totalPoints = calculatePoints(updated[playerId]);
                    return updated;
                });
            };

            const saveAllPoints = async () => {
                setSaving(true);
                setSuccessMsg('');
                try {
                    const { collection, addDoc, Timestamp } = window.firebaseModules;
                    
                    // Save each player's points
                    const pointsRef = collection(window.firebaseDb, 'playerMatchPoints');
                    const promises = players.map(player => {
                        const points = playerPoints[player.id];
                        return addDoc(pointsRef, {
                            matchId: match.id,
                            playerId: player.id,
                            playerName: player.name,
                            runs: points.runs,
                            wickets: points.wickets,
                            catches: points.catches,
                            runOuts: points.runOuts,
                            totalPoints: points.totalPoints,
                            updatedBy: user.uid,
                            updatedAt: Timestamp.now()
                        });
                    });
                    
                    await Promise.all(promises);
                    
                    // Calculate and update leaderboard
                    await calculateLeaderboard(match.id);
                    
                    setSuccessMsg('Points saved and leaderboard updated successfully!');
                    setTimeout(() => setSuccessMsg(''), 5000);
                } catch (error) {
                    console.error('Error saving points:', error);
                    alert('Error saving points. Please try again.');
                } finally {
                    setSaving(false);
                }
            };

            const calculateLeaderboard = async (matchId) => {
                try {
                    const { collection, query, where, getDocs, addDoc, deleteDoc, Timestamp } = window.firebaseModules;
                    const db = window.firebaseDb;
                    
                    // Get all player points for this match
                    const pointsRef = collection(db, 'playerMatchPoints');
                    const pointsQuery = query(pointsRef, where('matchId', '==', matchId));
                    const pointsSnapshot = await getDocs(pointsQuery);
                    
                    const playerPointsMap = {};
                    pointsSnapshot.forEach(doc => {
                        const data = doc.data();
                        playerPointsMap[data.playerId] = data.totalPoints;
                    });
                    
                    // Get all teams for this match
                    const teamsRef = collection(db, 'userTeams');
                    const teamsQuery = query(teamsRef, where('matchId', '==', matchId));
                    const teamsSnapshot = await getDocs(teamsQuery);
                    
                    const userScores = [];
                    const updatePromises = [];
                    
                    teamsSnapshot.forEach(doc => {
                        const team = doc.data();
                        let teamTotalPoints = 0;
                        
                        // Calculate points for each player
                        team.players.forEach(player => {
                            const basePoints = playerPointsMap[player.id] || 0;
                            let multiplier = 1;
                            
                            // Apply captain/vice-captain multipliers
                            if (player.id === team.captain) {
                                multiplier = 2;
                            } else if (player.id === team.viceCaptain) {
                                multiplier = 1.5;
                            }
                            
                            teamTotalPoints += (basePoints * multiplier);
                        });
                        
                        // Update team's total points
                        const { updateDoc, doc: docRef } = window.firebaseModules;
                        updatePromises.push(
                            updateDoc(doc.ref, { totalPoints: teamTotalPoints })
                        );
                        
                        userScores.push({
                            userId: team.userId,
                            userName: team.userName,
                            teamId: doc.id,
                            totalPoints: teamTotalPoints
                        });
                    });
                    
                    await Promise.all(updatePromises);
                    
                    // Sort by points (descending)
                    userScores.sort((a, b) => b.totalPoints - a.totalPoints);
                    
                    // Clear existing leaderboard for this match
                    const leaderboardRef = collection(db, 'leaderboard');
                    const existingQuery = query(leaderboardRef, where('matchId', '==', matchId));
                    const existingSnapshot = await getDocs(existingQuery);
                    
                    const deletePromises = [];
                    existingSnapshot.forEach(doc => {
                        deletePromises.push(deleteDoc(doc.ref));
                    });
                    await Promise.all(deletePromises);
                    
                    // Save new leaderboard
                    const savePromises = userScores.map((score, index) => {
                        return addDoc(leaderboardRef, {
                            matchId: matchId,
                            userId: score.userId,
                            userName: score.userName,
                            teamId: score.teamId,
                            totalPoints: score.totalPoints,
                            rank: index + 1,
                            updatedAt: Timestamp.now()
                        });
                    });
                    
                    await Promise.all(savePromises);
                    console.log('Leaderboard updated successfully');
                    
                } catch (error) {
                    console.error('Error calculating leaderboard:', error);
                    throw error;
                }
            };

            return (
                <div className="card">
                    <button onClick={onBack} className="btn" style={{ marginBottom: '20px' }}>‚Üê Back</button>
                    <h2>Update Points - {match.id}</h2>
                    
                    {successMsg && <div className="success-display">{successMsg}</div>}
                    
                    <div style={{ overflowX: 'auto' }}>
                        <table className="admin-table">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>Runs</th>
                                    <th>Wickets</th>
                                    <th>Catches</th>
                                    <th>Run Outs</th>
                                    <th>Total Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                {players.map(player => (
                                    <tr key={player.id}>
                                        <td style={{ fontWeight: '600' }}>{player.name}</td>
                                        <td>{player.team}</td>
                                        <td>
                                            <input
                                                type="number"
                                                min="0"
                                                className="admin-input"
                                                value={playerPoints[player.id]?.runs || 0}
                                                onChange={(e) => updatePlayerStat(player.id, 'runs', e.target.value)}
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                min="0"
                                                className="admin-input"
                                                value={playerPoints[player.id]?.wickets || 0}
                                                onChange={(e) => updatePlayerStat(player.id, 'wickets', e.target.value)}
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                min="0"
                                                className="admin-input"
                                                value={playerPoints[player.id]?.catches || 0}
                                                onChange={(e) => updatePlayerStat(player.id, 'catches', e.target.value)}
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                min="0"
                                                className="admin-input"
                                                value={playerPoints[player.id]?.runOuts || 0}
                                                onChange={(e) => updatePlayerStat(player.id, 'runOuts', e.target.value)}
                                            />
                                        </td>
                                        <td className="points-cell" style={{ color: '#10b981' }}>
                                            {playerPoints[player.id]?.totalPoints || 0}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    
                    <button 
                        onClick={saveAllPoints} 
                        disabled={saving}
                        className="btn" 
                        style={{ width: '100%', marginTop: '30px' }}
                    >
                        {saving ? 'Saving...' : 'Save All Points & Update Leaderboard'}
                    </button>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
